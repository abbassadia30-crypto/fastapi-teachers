<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Access Gateway | Institution Intelligence</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00bcd4;
            --bg: #000000;
            --card-bg: #121212;
            --text: #ffffff;
            --success: #2e7d32;
            --danger: #c62828;
        }

        body {
            margin: 0; padding: 0; font-family: 'Poppins', sans-serif;
            background: var(--bg); color: var(--text);
            height: 100vh; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
        }

        .gateway-box {
            text-align: center; width: 85%; max-width: 350px;
        }

        /* üèõÔ∏è Animated Radar Pulse */
        .radar {
            width: 100px; height: 100px; border-radius: 50%;
            border: 2px solid var(--primary); margin: 0 auto 30px;
            position: relative; display: flex; align-items: center;
            justify-content: center; animation: pulse 2s infinite;
        }
        .radar i { font-size: 40px; }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 188, 212, 0.4); }
            70% { box-shadow: 0 0 0 30px rgba(0, 188, 212, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 188, 212, 0); }
        }

        h1 { font-size: 20px; font-weight: 700; margin-bottom: 10px; letter-spacing: 1px; }
        .status-text { font-size: 12px; color: #666; text-transform: uppercase; font-weight: 600; }

        .progress-bar {
            width: 100%; height: 4px; background: #1a1a1a;
            border-radius: 10px; margin-top: 25px; overflow: hidden;
        }
        .progress-fill {
            width: 0%; height: 100%; background: var(--primary);
            transition: 0.5s ease-in-out;
        }

        /* Red/Green Sign Box */
        #sign-box {
            display: none; position: fixed; top: 25px; left: 50%;
            transform: translateX(-50%); width: 85%; padding: 12px;
            border-radius: 10px; text-align: center; font-weight: 600; z-index: 2000;
        }
        .bg-red { background: var(--danger); color: white; }
    </style>
</head>
<body>

<div id="sign-box"></div>

<div class="gateway-box">
    <div class="radar">üîç</div>
    <h1>Establishing Platform</h1>
    <div class="status-text" id="status">Verifying Identity Key...</div>

    <div class="progress-bar">
        <div class="progress-fill" id="fill"></div>
    </div>
</div>

<script>
    async function startGatewayHandshake() {
        const fill = document.getElementById('fill');
        const status = document.getElementById('status');
        const token = localStorage.getItem('institutionToken');

        if (!token) {
            showNotify("Access Denied: No Token Found", "error");
            setTimeout(() => window.location.href = "../../login.html", 2000);
            return;
        }

        // Step 1: Verification
        fill.style.width = "30%";

        try {
            // Mocking the check for backend access
            const res = await fetch("https://fastapi-teachers.onrender.com/document/my-files", {
                headers: { 'Authorization': `Bearer ${token}` }
            });

            if(res.ok) {
                fill.style.width = "70%";
                status.innerText = "Synchronizing Search Vaults...";

                setTimeout(() => {
                    fill.style.width = "100%";
                    status.innerText = "Access Granted";
                    window.location.href = "../../plateforme/search.html";
                }, 1000);
            } else {
                throw new Error("Invalid Session");
            }
        } catch (err) {
            showNotify("Gateway Timeout: Re-authentication Required", "error");
        }
    }

    function showNotify(msg, type) {
        const box = document.getElementById('sign-box');
        box.innerText = msg;
        box.className = type === 'error' ? 'bg-red' : 'bg-green';
        box.style.display = 'block';
    }

    // Trigger on load
    window.onload = startGatewayHandshake;
</script>

</body>
</html>