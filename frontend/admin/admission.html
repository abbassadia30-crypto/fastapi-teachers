<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Admission - Institution</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0288d1;
            --secondary: #263238;
            --accent: #00bcd4;
            --bg: #f0f2f5;
        }

        body { 
            font-family: 'Poppins', sans-serif; 
            margin: 0; 
            background: var(--bg); 
            display: flex; 
            flex-direction: column; 
            min-height: 100vh;
        }

        /* Notification Bar */
        #notification-bar {
            position: fixed; top: -100px; left: 50%; transform: translateX(-50%); 
            width: 90%; max-width: 400px; padding: 15px; border-radius: 12px; 
            color: white; text-align: center; transition: 0.4s; z-index: 2000; font-weight: 600;
        }
        .bg-red { background: #ef5350; top: 20px !important; }
        .bg-green { background: #66bb6a; top: 20px !important; }

        header { 
            padding: 20px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .back-btn {
            background: #f0f2f5;
            border: none;
            padding: 8px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            color: var(--secondary);
        }

        header h1 { color: var(--secondary); margin: 0; font-size: 20px; flex: 1; text-align: center; }

        .form-container { padding: 20px; flex: 1; }

        .admission-card {
            background: white; border-radius: 20px; padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 13px; font-weight: 600; color: var(--secondary); margin-bottom: 5px; }

        input, select {
            width: 100%; padding: 12px; border-radius: 12px;
            border: 1px solid #ddd; font-family: 'Poppins'; outline: none;
            box-sizing: border-box;
        }

        .flex-row-btn {
            background: #e3f2fd; color: var(--primary); border: none;
            padding: 10px 15px; border-radius: 10px; font-size: 12px;
            font-weight: 600; cursor: pointer; margin-bottom: 20px;
            width: 100%;
        }

        .submit-btn {
            background: var(--primary); color: white; border: none;
            padding: 15px; width: 100%; border-radius: 15px;
            font-weight: 600; cursor: pointer;
            transition: 0.3s;
        }
        .submit-btn:hover { background: #0277bd; }
        
        .row-item { display: flex; gap: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="notification-bar"></div>

    <header>
        <button class="back-btn" onclick="location.href='dashboard.html'">‚Üê Back</button>
        <h1>Admission Desk</h1>
        <div style="width: 70px;"></div> </header>

    <div class="form-container">
        <div class="admission-card">
            <form id="admissionForm">
                <div class="input-group">
                    <label>Student Full Name</label>
                    <input type="text" id="stdName" placeholder="Full legal name" required>
                </div>

                <div class="input-group">
                    <label>Select Section</label>
                    <select id="sectionSelect" onchange="checkCustom(this)" required></select>
                </div>

                <div class="input-group" id="customSectionGroup" style="display:none;">
                    <label>New Section Name</label>
                    <input type="text" id="newSectionInput" placeholder="Enter custom section name">
                </div>

                <div class="input-group">
                    <label>Admission Fee</label>
                    <input type="number" id="stdFee" placeholder="0.00" required>
                </div>

                <div id="flexibleRows"></div>

                <button type="button" class="flex-row-btn" onclick="addNewRow()">+ Add Extra Field (Phone, Address, etc.)</button>
                
                <button type="submit" class="submit-btn" id="subBtn">Complete Admission</button>
            </form>
        </div>
    </div>

    <script>
        const adminEmail = localStorage.getItem('userEmail');
        const sectionDropdown = document.getElementById('sectionSelect');
        let savedSections = JSON.parse(localStorage.getItem('customSections')) || [];

        // Check if admin is logged in
        if (!adminEmail) { window.location.href = "../index.html"; }

        function showNotify(msg, type) {
            const bar = document.getElementById('notification-bar');
            bar.innerText = msg;
            bar.className = type === 'success' ? 'bg-green' : 'bg-red';
            setTimeout(() => bar.className = '', 3000);
        }

        function populateSections() {
            sectionDropdown.innerHTML = '<option value="" disabled selected>Choose Class/Section</option>';
            for(let i=1; i<=12; i++) {
                let opt = document.createElement('option');
                opt.value = "Class " + i;
                opt.innerHTML = "Class " + i;
                sectionDropdown.appendChild(opt);
            }
            savedSections.forEach(sec => {
                let opt = document.createElement('option');
                opt.value = sec;
                opt.innerHTML = sec;
                sectionDropdown.appendChild(opt);
            });
            let addOpt = document.createElement('option');
            addOpt.value = "ADD_NEW";
            addOpt.innerHTML = "+ Add New Section Name...";
            sectionDropdown.appendChild(addOpt);
        }

        function checkCustom(select) {
            document.getElementById('customSectionGroup').style.display = 
                (select.value === "ADD_NEW") ? "block" : "none";
        }

        function addNewRow() {
    const container = document.getElementById('flexibleRows');
    const rowId = 'row_' + Date.now(); // Unique ID for each row
    const div = document.createElement('div');
    div.className = "row-item";
    div.id = rowId;
    div.innerHTML = `
        <input type="text" placeholder="Label" class="extra-key" style="width:35%;">
        <input type="text" placeholder="Value" class="extra-val" style="width:50%;">
        <button type="button" onclick="removeRow('${rowId}')" 
            style="width:10%; background:none; border:none; color:#ef5350; cursor:pointer; font-size:18px;">
            üóëÔ∏è
        </button>
    `;
    container.appendChild(div);
}

function removeRow(id) {
    const row = document.getElementById(id);
    if (row) row.remove();
}
        document.getElementById('admissionForm').onsubmit = function(e) {
            e.preventDefault();
            const btn = document.getElementById('subBtn');
            btn.disabled = true;

            let finalSection = sectionDropdown.value;
            if(finalSection === "ADD_NEW") {
                finalSection = document.getElementById('newSectionInput').value;
                if(!savedSections.includes(finalSection) && finalSection !== "") {
                    savedSections.push(finalSection);
                    localStorage.setItem('customSections', JSON.stringify(savedSections));
                }
            }

            // Gather extra fields
            const extraData = {};
            const keys = document.querySelectorAll('.extra-key');
            const vals = document.querySelectorAll('.extra-val');
            keys.forEach((k, i) => {
                if(k.value) extraData[k.value] = vals[i].value;
            });

            const admissionData = {
                studentName: document.getElementById('stdName').value,
                section: finalSection,
                fee: document.getElementById('stdFee').value,
                admittedBy: adminEmail, // OWNERSHIP: Only this admin can see this data
                admittedAt: new Date().toLocaleString(),
                extraFields: extraData
            };

            // Developer Note: Ready for Backend integration
            let students = JSON.parse(localStorage.getItem('admittedStudents')) || [];
            students.push(admissionData);
            localStorage.setItem('admittedStudents', JSON.stringify(students));

            showNotify(`Student admitted to ${finalSection} successfully!`, "success");

            setTimeout(() => {
                location.reload(); 
            }, 2000);
        };

        populateSections();
    </script>
</body>
</html>