<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Marksheet Architect | Institution Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #fb8c00; /* Professional Orange for Academic/Results */
      --secondary: #263238;
      --bg: #f8fafc;
      --border: #e2e8f0;
      --success: #4caf50;
      --danger: #f44336;
    }

    body { font-family: 'Poppins', sans-serif; margin: 0; background: var(--bg); display: flex; flex-direction: column; height: 100vh; }

    #notification-bar {
      position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
      width: 90%; max-width: 400px; padding: 15px; border-radius: 12px;
      color: white; text-align: center; transition: 0.4s; z-index: 2000; font-weight: 600;
    }
    .bg-red { background: var(--danger); top: 20px !important; }
    .bg-green { background: var(--success); top: 20px !important; }

    header { background: white; padding: 20px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }

    .main-container { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 120px; }

    .config-card { background: white; border-radius: 20px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--border); }

    label { font-size: 11px; font-weight: 700; color: var(--secondary); text-transform: uppercase; margin-bottom: 8px; display: block; }

    input, select {
      width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid var(--border); border-radius: 10px; box-sizing: border-box; font-family: inherit;
    }

    /* Subject Entry Grid */
    .subject-row {
      display: grid; grid-template-columns: 2fr 1fr 1fr 40px; gap: 8px; margin-bottom: 10px;
    }
    .remove-btn { color: var(--danger); font-weight: 800; cursor: pointer; text-align: center; align-self: center; }

    /* Professional Marksheet Preview */
    .marksheet-preview {
      background: white; border-top: 8px solid var(--primary); border-radius: 12px;
      padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    }
    .institution-header { text-align: center; border-bottom: 2px double #eee; padding-bottom: 10px; margin-bottom: 15px; }

    table { width: 100%; border-collapse: collapse; font-size: 12px; }
    th { background: #f1f5f9; text-align: left; padding: 10px; border: 1px solid #eee; }
    td { padding: 10px; border: 1px solid #eee; }

    .result-summary {
      margin-top: 20px; display: flex; justify-content: space-between;
      background: var(--secondary); color: white; padding: 15px; border-radius: 10px;
    }

    .publish-footer { position: fixed; bottom: 0; width: 100%; background: white; padding: 20px; border-top: 1px solid #eee; display: flex; box-sizing: border-box; }
    .btn-main { background: var(--primary); color: white; border: none; flex: 1; padding: 15px; border-radius: 15px; font-weight: 700; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>

<div id="notification-bar"></div>

<header>
  <div onclick="history.back()" style="font-size:24px; cursor:pointer;">✕</div>
  <h2 style="margin:0; font-size:16px; font-weight:800;">Marksheet Architect</h2>
  <div style="width:24px;"></div>
</header>

<div class="main-container">
  <div class="config-card">
    <label>Exam Title</label>
    <input type="text" id="exam-title" placeholder="e.g. First Term Examination 2026" oninput="updatePreview()">

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
      <div><label>Class</label><select id="class-select" onchange="updatePreview()">
        <option>Grade 10 - A</option>
        <option>Grade 9 - B</option>
      </select></div>
      <div><label>Passing %</label><input type="number" id="pass-percent" value="33" oninput="updatePreview()"></div>
    </div>
  </div>

  <div class="config-card">
    <label>Subjects & Weightage</label>
    <div id="subject-list">
      <div class="subject-row">
        <input type="text" placeholder="Subject" class="s-name" oninput="updatePreview()">
        <input type="number" placeholder="Total" class="s-total" oninput="updatePreview()">
        <input type="number" placeholder="Obt." class="s-obt" oninput="updatePreview()">
        <div class="remove-btn" onclick="this.parentElement.remove(); updatePreview();">✕</div>
      </div>
    </div>
    <button style="width:100%; padding:10px; border: 2px dashed #ccc; border-radius:10px; background:none; font-weight:600; cursor:pointer;" onclick="addSubject()">+ Add Subject</button>
  </div>

  <label>Result Template Preview</label>
  <div class="marksheet-preview">
    <div class="institution-header">
      <div style="font-weight: 800; font-size: 16px;">OFFICIAL STATEMENT OF MARKS</div>
      <div style="font-size: 10px; color: #666;" id="pre-exam">Exam Title Here</div>
    </div>

    <div style="margin-bottom: 10px; font-size: 11px;">
      NAME: <b style="color:var(--primary)">[STUDENT NAME]</b><br>
      CLASS: <span id="pre-class">-</span>
    </div>

    <table>
      <thead>
      <tr>
        <th>Subject</th>
        <th>Max</th>
        <th>Obt</th>
        <th>Status</th>
      </tr>
      </thead>
      <tbody id="pre-table-body">
      </tbody>
    </table>

    <div class="result-summary">
      <div>
        <div style="font-size: 10px; opacity: 0.8;">PERCENTAGE</div>
        <div style="font-size: 18px; font-weight: 700;" id="pre-percentage">0%</div>
      </div>
      <div style="text-align: right;">
        <div style="font-size: 10px; opacity: 0.8;">FINAL GRADE</div>
        <div style="font-size: 18px; font-weight: 700;" id="pre-grade">-</div>
      </div>
    </div>
  </div>
</div>

<div class="publish-footer">
  <button class="btn-main" onclick="saveMarksheet()">Generate & Notify Students</button>
</div>

<script>
  function addSubject() {
    const div = document.createElement('div');
    div.className = 'subject-row';
    div.innerHTML = `
            <input type="text" placeholder="Subject" class="s-name" oninput="updatePreview()">
            <input type="number" placeholder="Total" class="s-total" oninput="updatePreview()">
            <input type="number" placeholder="Obt." class="s-obt" oninput="updatePreview()">
            <div class="remove-btn" onclick="this.parentElement.remove(); updatePreview();">✕</div>
        `;
    document.getElementById('subject-list').appendChild(div);
  }

  function calculateGrade(per) {
    if (per >= 90) return "A+";
    if (per >= 80) return "A";
    if (per >= 70) return "B";
    if (per >= 60) return "C";
    if (per >= 50) return "D";
    return "F";
  }

  function updatePreview() {
    document.getElementById('pre-exam').innerText = document.getElementById('exam-title').value || "Exam Title Here";
    document.getElementById('pre-class').innerText = document.getElementById('class-select').value;

    const names = document.querySelectorAll('.s-name');
    const totals = document.querySelectorAll('.s-total');
    const obts = document.querySelectorAll('.s-obt');
    const passCriteria = parseFloat(document.getElementById('pass-percent').value) || 33;

    const tbody = document.getElementById('pre-table-body');
    tbody.innerHTML = '';

    let grandTotal = 0;
    let grandObt = 0;

    names.forEach((n, i) => {
      const max = parseFloat(totals[i].value) || 0;
      const obt = parseFloat(obts[i].value) || 0;
      grandTotal += max;
      grandObt += obt;

      const status = (obt/max * 100) >= passCriteria ? "PASS" : "FAIL";
      const color = status === "PASS" ? "green" : "red";

      tbody.innerHTML += `
                <tr>
                    <td>${n.value || 'Subject'}</td>
                    <td>${max}</td>
                    <td>${obt}</td>
                    <td style="color:${color}; font-weight:bold;">${status}</td>
                </tr>
            `;
    });

    const finalPer = grandTotal > 0 ? ((grandObt / grandTotal) * 100).toFixed(1) : 0;
    document.getElementById('pre-percentage').innerText = finalPer + "%";
    document.getElementById('pre-grade').innerText = finalPer > 0 ? calculateGrade(finalPer) : "-";
  }

  function showNotify(msg, type) {
    const bar = document.getElementById('notification-bar');
    bar.innerText = msg;
    bar.className = type === 'error' ? 'bg-red' : 'bg-green';
    setTimeout(() => bar.className = "", 3000);
  }

  function saveMarksheet() {
    showNotify("Saving Marksheets & Notifying Parent App...", "green");
    // Logic: Save Template to DB -> Loop through Student IDs in Class -> Inject and Generate docs
  }
</script>
</body>
</html>