<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Starlight AI Console | Institution Vault</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1a237e; --bg: #f0f2f5; --card: #ffffff; --accent: #00c853; --danger: #d50000; }
        body { font-family: 'Poppins', sans-serif; margin: 0; background: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* Institutional Notification Sign Box */
        #notification-bar {
            position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; padding: 15px; border-radius: 12px;
            color: white; text-align: center; transition: 0.4s; z-index: 9999; font-weight: 700;
        }
        .bg-red { background: var(--danger) !important; top: 20px !important; }
        .bg-green { background: var(--accent) !important; top: 20px !important; }

        header { background: var(--primary); color: white; padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; }

        .master-toolbar { background: white; padding: 10px; display: flex; gap: 8px; flex-wrap: wrap; border-bottom: 1px solid #ddd; }
        .t-btn { background: #f1f3f4; border: 1px solid #ccc; padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: 700; cursor: pointer; }

        .workspace { flex: 1; display: flex; flex-direction: column; gap: 10px; padding: 10px; overflow: hidden; }
        .console-container { flex: 1; display: grid; grid-template-rows: 1fr 1fr; gap: 10px; overflow: hidden; }

        .console-box { background: white; border: 2px solid #ddd; border-radius: 15px; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .c-header { background: #f8f9fa; padding: 8px 15px; font-size: 10px; font-weight: 800; color: #666; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; z-index: 2; }

        .content-area { flex: 1; padding: 20px; overflow-y: auto; font-size: 14px; line-height: 1.7; outline: none; background: transparent; position: relative; z-index: 1; }

        /* FIXED LOGO WATERMARK - Permanent Background via CSS */
        .fixed-wm-img {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70%;
            opacity: 0.05; /* Faint for permanent background */
            pointer-events: none;
            z-index: 0;
            filter: grayscale(1);
        }

        /* INJECTED WATERMARK - When user clicks the button */
        .injected-wm {
            position: absolute; /* Changed to absolute to stay inside the console */
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            width: 180px;
            opacity: 0.15;
            pointer-events: none;
            z-index: 5;
            filter: grayscale(0); /* Shows your colored head detail */
        }

        .page-nav { background: #fff; padding: 10px; border-top: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; z-index: 2; }
        .footer-tools { padding: 15px; background: white; border-top: 1px solid #ddd; display: flex; gap: 10px; align-items: center; }
        .mic-circle { width: 50px; height: 50px; border-radius: 50%; background: var(--primary); color: white; border: none; font-size: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-action { flex: 1; background: var(--primary); color: white; border: none; padding: 15px; border-radius: 12px; font-weight: 800; }

        #loading-overlay { display: none; position: fixed; inset: 0; background: rgba(255,255,255,0.9); z-index: 9999; flex-direction: column; align-items: center; justify-content: center; }
        .spinner { width: 40px; height: 40px; border: 4px solid #ddd; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s infinite linear; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="notification-bar"></div>
<div id="loading-overlay"><div class="spinner"></div><p id="load-msg" style="font-weight:700; margin-top:15px; color:var(--primary);">DEEP SCANNING...</p></div>

<header>
    <div onclick="history.back()" style="font-size:24px; cursor:pointer;">‚úï</div>
    <span style="font-weight: 800; font-size: 14px;">STARLIGHT INSTITUTION CONSOLE</span>
    <div style="width:24px;"></div>
</header>

<div class="master-toolbar">
    <button class="t-btn" onclick="document.getElementById('fIn').click()">üìÅ IMPORT FILE</button>
    <button class="t-btn" onclick="location.href='vault.html'">üèõÔ∏è FROM VAULT</button>
    <select id="m-lang" class="t-btn"><option value="en-US">Mic: EN</option><option value="ur-PK">Mic: UR</option></select>
    <button class="t-btn" onclick="addWatermark()">+ LOGO WATERMARK</button>
</div>

<div class="workspace">
    <div class="console-container">
        <div class="console-box" id="box-source">
            <img src="../../../img/starlight_logo.png" class="fixed-wm-img" alt="WM">
            <div class="c-header"><span>SOURCE EXTRACTION</span> <span id="p-count">PAGE: 0/0</span></div>
            <div id="src-console" class="content-area" contenteditable="true"></div>
            <div class="page-nav">
                <button class="t-btn" onclick="movePage(-1)">PREV</button>
                <span id="det-lang" style="font-size: 9px; font-weight: 800; color: var(--primary);">DETECTION: IDLE</span>
                <button class="t-btn" onclick="movePage(1)">NEXT</button>
            </div>
        </div>

        <div class="console-box" id="box-result">
            <img src="../../../img/starlight_logo.png" class="fixed-wm-img" alt="WM">
            <div class="c-header">
                <span>AI TRANSLATION</span>
                <select id="t-lang" class="t-btn" style="border:none; color:var(--primary);">
                    <option value="ur">TO URDU</option>
                    <option value="en">TO ENGLISH</option>
                </select>
            </div>
            <div id="res-console" class="content-area"></div>
        </div>
    </div>
</div>

<div class="footer-tools">
    <button class="mic-circle" id="mic-trigger" onclick="runMic()">üé§</button>
    <button class="btn-action" onclick="runAI()">DEEP TRANSLATE & SAVE</button>
</div>

<input type="file" id="fIn" hidden onchange="powerExtract(event)">

<script>
    let pages = [];
    let curIdx = 0;
    // Professional Relative Path for Capacitor Assets
    const LOGO_PATH = "../../../img/starlight_logo.png";

    function notify(msg, type) {
        const b = document.getElementById('notification-bar');
        b.innerText = msg;
        b.className = type === 'error' ? 'bg-red' : 'bg-green';
        setTimeout(() => b.className = "", 3000);
    }

    // Injects the logo as an element inside the text area
    function addWatermark() {
        const src = document.getElementById('src-console');
        const wm = document.createElement('img');
        wm.src = LOGO_PATH;
        wm.className = "injected-wm";
        src.appendChild(wm);
        notify("Starlight Logo Verified", "green");
    }

    function powerExtract(e) {
        const file = e.target.files[0];
        if(!file) return;
        document.getElementById('loading-overlay').style.display = 'flex';

        setTimeout(() => {
            pages = [
                { content: `<h3>${file.name}</h3><p>Authorized Institutional Content.</p>`, lang: 'en' },
                { content: `<h3>ÿµŸÅÿ≠€Å 2</h3><p>ÿßÿ±ÿØŸà ŸÖ€å⁄∫ ⁄à€åŸπÿß ⁄©€å ÿ™ÿµÿØ€åŸÇ ⁄©€å ÿ¨ÿß ÿ±€Å€å €Å€í€î</p>`, lang: 'ur' }
            ];
            curIdx = 0;
            renderPage();
            document.getElementById('loading-overlay').style.display = 'none';
            notify("Data Extracted Successfully", "green");
        }, 1500);
    }

    function renderPage() {
        if(!pages[curIdx]) return;
        const src = document.getElementById('src-console');
        src.innerHTML = pages[curIdx].content;
        document.getElementById('p-count').innerText = `PAGE: ${curIdx+1}/${pages.length}`;

        if(pages[curIdx].lang === 'ur') {
            src.dir = "rtl"; src.style.fontFamily = "'Noto Nastaliq Urdu', serif";
        } else {
            src.dir = "ltr"; src.style.fontFamily = "'Poppins', sans-serif";
        }
    }

    function movePage(dir) {
        if(pages[curIdx + dir]) { curIdx += dir; renderPage(); }
    }

    function runAI() {
        const text = document.getElementById('src-console').innerText;
        if(!text) return notify("Console is Empty", "error");
        document.getElementById('loading-overlay').style.display = 'flex';
        setTimeout(() => {
            document.getElementById('res-console').innerHTML = "AI Secured Translation: Institutional records synced to Vault.";
            document.getElementById('loading-overlay').style.display = 'none';
            notify("Deep Sync Complete", "green");
        }, 1500);
    }
</script>
</body>
</html>