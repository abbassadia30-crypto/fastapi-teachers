<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Forgot Password</title>
    <link rel="stylesheet" href="login.css">
</head>
<body>
    <div id="notification-bar"></div>
    <div class="card">
        <h2>Reset Password</h2>
        <p class="sub-text">Enter your email to receive a reset code.</p>
        <form onsubmit="sendResetCode(event)">
            <div class="input-group">
                <input type="email" id="resetEmail" placeholder="Institutional Email" required>
            </div>
            <button type="submit" class="btn" id="btn"  onclick="sendRestCode()">Send Code</button>
        </form>
    </div>
    <script>
async function sendResetCode(e) {
    e.preventDefault();
    const email = document.getElementById('resetEmail').value.trim();
    const btn = document.getElementById("btn");

    btn.disabled = true;
    btn.innerText = "Sending...";

    try {
        const response = await fetch(`${API_BASE}/forgot-password`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
        });

        if (response.ok) {
            // Store email so verify.html knows where to send the OTP
            localStorage.setItem('pendingEmail', email); 
            localStorage.setItem('isPasswordReset', 'true'); // Flag to tell verify.html this is a reset, not signup
            window.location.href = "verify.html";
        } else {
            const result = await response.json();
            Notification.show(result.detail || "Email not found", "error");
        }
    } catch (err) {
        Notification.show("Connection Error", "error");
    } finally {
        btn.disabled = false;
        btn.innerText = "Send Code";
    }
}
</script>
</body>
</html>