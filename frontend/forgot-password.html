<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Forgot Password</title>
    <link rel="stylesheet" href="login.css">
    <style>
        /* Adding basic styles for the notification bar since it was missing */
        #notification-bar {
            position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; padding: 15px; border-radius: 12px;
            color: white; font-weight: 600; text-align: center;
            transition: 0.4s ease-in-out; z-index: 1000;
        }
        .bg-red { background: #ef5350; top: 20px !important; }
        .bg-green { background: #66bb6a; top: 20px !important; }
    </style>
</head>
<body>
    <div id="notification-bar"></div>
    <div class="card">
        <h2>Reset Password</h2>
        <p class="sub-text">Enter your email to receive a reset code.</p>
        <form onsubmit="sendResetCode(event)">
            <div class="input-group">
                <input type="email" id="resetEmail" placeholder="Institutional Email" required>
            </div>
            <button type="submit" class="btn" id="btn">Send Code</button>
            <button type="button" class="btn" id="btn2" onclick="back()">Back to login</button>
        </form>
    </div>

<script>
    // 1. MUST DEFINE API_BASE
    const API_BASE = "https://fastapi-teachers.onrender.com";

    // 2. Add showBar function (replaces Notification.show)
    function showBar(msg, type) {
        const bar = document.getElementById('notification-bar');
        bar.innerText = msg;
        bar.className = type === 'error' ? 'bg-red' : 'bg-green';
        setTimeout(() => { bar.className = ""; }, 4000);
    }

    async function back() {
        window.location.href = "index.html";
    }

    async function sendResetCode(e) {
        e.preventDefault();
        const email = document.getElementById('resetEmail').value.trim();
        const btn = document.getElementById("btn");

        btn.disabled = true;
        btn.innerText = "Sending...";

        try {
            const response = await fetch(`${API_BASE}/forgot-password`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: email })
            });

            if (response.ok) {
                localStorage.setItem('pendingEmail', email); 
                localStorage.setItem('isPasswordReset', 'true'); 
                window.location.href = "verify.html";
            } else {
                const result = await response.json();
                // Changed from Notification.show to showBar
                showBar(result.detail || "Email not found", "error");
            }
        } catch (err) {
            showBar("Connection Error", "error");
        } finally {
            btn.disabled = false;
            btn.innerText = "Send Code";
        }
    }
</script>
</body>
</html>